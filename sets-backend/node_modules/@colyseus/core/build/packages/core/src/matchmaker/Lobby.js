'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var tslib_es6 = require('../../../../node_modules/tslib/tslib.es6.js');
var MatchMaker = require('../MatchMaker.js');

const LOBBY_CHANNEL = '$lobby';
function updateLobby(room, removed = false) {
    const listing = room.listing;
    if (!listing.unlisted && !listing.private) {
        MatchMaker.presence.publish(LOBBY_CHANNEL, `${listing.roomId},${removed ? 1 : 0}`);
    }
}
function subscribeLobby(callback) {
    return tslib_es6.__awaiter(this, void 0, void 0, function* () {
        const cb = (message) => tslib_es6.__awaiter(this, void 0, void 0, function* () {
            const [roomId, isRemove] = message.split(',');
            if (isRemove === '1') {
                callback(roomId, null);
            }
            else {
                const room = (yield MatchMaker.query({ roomId }))[0];
                callback(roomId, room);
            }
        });
        yield MatchMaker.presence.subscribe(LOBBY_CHANNEL, cb);
        return () => MatchMaker.presence.unsubscribe(LOBBY_CHANNEL, cb);
    });
}

exports.subscribeLobby = subscribeLobby;
exports.updateLobby = updateLobby;
//# sourceMappingURL=Lobby.js.map
